{"remainingRequest":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/david/Workspace/PrestaShop/ps_accounts/_dev/src/components/PsAccount.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/src/components/PsAccount.vue","mtime":1581094375456},{"path":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/node_modules/cache-loader/dist/cjs.js","mtime":1580829599339},{"path":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/node_modules/thread-loader/dist/cjs.js","mtime":1580829599315},{"path":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/node_modules/babel-loader/lib/index.js","mtime":1580829599343},{"path":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/node_modules/cache-loader/dist/cjs.js","mtime":1580829599339},{"path":"/home/david/Workspace/PrestaShop/ps_accounts/_dev/node_modules/vue-loader/lib/index.js","mtime":1580829601153}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi8KZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdQc0FjY291bnQnLAogIHByb3BzOiB7CiAgICBidXR0b25UZXh0OiBTdHJpbmcsCiAgICB2dWVfYXBwX3N2Y191aV91cmw6IFN0cmluZywKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzdmNfdWlfdXJsOiBudWxsLAogICAgICBwYXJhbXNfbG9hZGVkOiBmYWxzZSwKICAgICAgcXVlcnlQYXJhbXM6IHsKICAgICAgICBwdWJLZXk6IG51bGwsCiAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICBibzogbnVsbCwKICAgICAgICBuZXh0OiBudWxsLAogICAgICB9LAogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuZ2V0U3ZjVWlVcmwoCiAgICAgIHByb2Nlc3MuZW52LlZVRV9BUFBfU1NPX1VSTCwKICAgICAgd2luZG93LnByb3RvY29sRG9tYWluVG9WYWxpZGF0ZSwKICAgICAgd2luZG93LmRvbWFpbk5hbWVEb21haW5Ub1ZhbGlkYXRlLAogICAgICB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wuc2xpY2UoMCwgLTEpLAogICAgICB3aW5kb3cubG9jYXRpb24uaG9zdCwKICAgICAgd2luZG93LnF1ZXJ5UGFyYW1zLAogICAgICB3aW5kb3cucHViS2V5LAogICAgICB3aW5kb3cuc2hvcE5hbWUsCiAgICAgICcyJwogICAgKQogIH0sCgogIG1ldGhvZHM6IHsKICAgIGNvbm5lY3RTdmNVaSgpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UodGhpcy5zdmNfdWlfdXJsKQogICAgfSwKICAgIGdldFN2Y1VpVXJsKAogICAgICBzc29fdXJsLAogICAgICBwcm90b2NvbERvbWFpblRvVmFsaWRhdGUsCiAgICAgIGRvbWFpbk5hbWVEb21haW5Ub1ZhbGlkYXRlLAogICAgICBwcm90b2NvbEJvLAogICAgICBkb21haW5OYW1lQm8sCiAgICAgIHF1ZXJ5UGFyYW1zLAogICAgICBwdWJLZXksCiAgICAgIHNob3BOYW1lLAogICAgICBuZXh0U3RlcAogICAgKSB7CiAgICAgIHRoaXMuc3ZjX3VpX3VybCA9CiAgICAgICAgc3NvX3VybCArCiAgICAgICAgJy9saW5rLXNob3AvJyArCiAgICAgICAgcHJvdG9jb2xEb21haW5Ub1ZhbGlkYXRlICsKICAgICAgICAnLycgKwogICAgICAgIGRvbWFpbk5hbWVEb21haW5Ub1ZhbGlkYXRlICsKICAgICAgICAnLycgKwogICAgICAgIHByb3RvY29sQm8gKwogICAgICAgICcvJyArCiAgICAgICAgZG9tYWluTmFtZUJvICsKICAgICAgICAnL1BTWEVtb2ppLkRlbHV4ZS5GYWtlLlNlcnZpY2UnCgogICAgICBsZXQgYm9QYXRoID0gJycKICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHF1ZXJ5UGFyYW1zKSkgewogICAgICAgIGJvUGF0aCArPSBrZXkgKyAnPScgKyB2YWx1ZSArICcmJwogICAgICB9CmNvbnNvbGUubG9nKCdkZGRkZGRkZGQnKQogICAgICB0aGlzLnF1ZXJ5UGFyYW1zLmJvID0KICAgICAgICAnc3RyaW5nJyA9PT0gdHlwZW9mIGJvUGF0aAogICAgICAgICAgPyBlbmNvZGVVUklDb21wb25lbnQoYm9QYXRoLnNsaWNlKDAsIC0xKSkKICAgICAgICAgIDogbnVsbAogICAgICB0aGlzLnF1ZXJ5UGFyYW1zLnB1YktleSA9CiAgICAgICAgJ3N0cmluZycgPT09IHR5cGVvZiBwdWJLZXkgPyBlbmNvZGVVUklDb21wb25lbnQocHViS2V5KSA6IG51bGwKICAgICAgdGhpcy5xdWVyeVBhcmFtcy5uYW1lID0KICAgICAgICAnc3RyaW5nJyA9PT0gdHlwZW9mIHdpbmRvdy5zaG9wTmFtZQogICAgICAgICAgPyBlbmNvZGVVUklDb21wb25lbnQod2luZG93LnNob3BOYW1lKQogICAgICAgICAgOiBudWxsCiAgICAgIHRoaXMucXVlcnlQYXJhbXMubmV4dCA9CiAgICAgICAgJ3N0cmluZycgPT09IHR5cGVvZiBuZXh0U3RlcCA/IGVuY29kZVVSSUNvbXBvbmVudChuZXh0U3RlcCkgOiBudWxsCiAgICAgIHRoaXMucXVlcnlQYXJhbXNMb2FkZWQoKQoKICAgICAgcmV0dXJuIHRoaXMuc3ZjX3VpX3VybAogICAgfSwKCiAgICBxdWVyeVBhcmFtc0xvYWRlZCgpIHsKICAgICAgY29uc3QgY291bnRJbml0UXVlcnlQYXJhbXMgPSBPYmplY3Qua2V5cyh0aGlzLnF1ZXJ5UGFyYW1zKS5sZW5ndGgKICAgICAgbGV0IGNvdW50ZXJWYWxpZGVQYXJhbXMgPSAwCiAgICAgIHRoaXMuc3ZjX3VpX3VybCArPSAnPycKICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMucXVlcnlQYXJhbXMpKSB7CiAgICAgICAgaWYgKG51bGwgIT09IHZhbHVlKSB7CiAgICAgICAgICBjb3VudGVyVmFsaWRlUGFyYW1zKysKICAgICAgICAgIHRoaXMuc3ZjX3VpX3VybCArPSBgJHtrZXl9PSR7dmFsdWV9JmAKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChjb3VudEluaXRRdWVyeVBhcmFtcyA9PT0gY291bnRlclZhbGlkZVBhcmFtcykgewogICAgICAgIHRoaXMucGFyYW1zX2xvYWRlZCA9IHRydWUKICAgICAgICB0aGlzLnN2Y191aV91cmwgPSB0aGlzLnN2Y191aV91cmwuc2xpY2UoMCwgLTEpCiAgICAgIH0KICAgIH0sCiAgfSwKfQo="},{"version":3,"sources":["PsAccount.vue"],"names":[],"mappings":";;;;;;;;;;;;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PsAccount.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <div v-if=\"params_loaded\" class=\"ps_account text-center\">\n      <button @click.stop.prevent=\"connectSvcUi()\" class=\"btn btn-primary\">\n        {{ buttonText }}\n      </button>\n    </div>\n    <div v-else class=\"forbidden text-center\">\n      Restart onboarding\n    </div>\n  </div>\n</template>\n<script>\n/* eslint-disable no-console */\nexport default {\n  name: 'PsAccount',\n  props: {\n    buttonText: String,\n    vue_app_svc_ui_url: String,\n  },\n  data() {\n    return {\n      svc_ui_url: null,\n      params_loaded: false,\n      queryParams: {\n        pubKey: null,\n        name: null,\n        bo: null,\n        next: null,\n      },\n    }\n  },\n  mounted() {\n    this.getSvcUiUrl(\n      process.env.VUE_APP_SSO_URL,\n      window.protocolDomainToValidate,\n      window.domainNameDomainToValidate,\n      window.location.protocol.slice(0, -1),\n      window.location.host,\n      window.queryParams,\n      window.pubKey,\n      window.shopName,\n      '2'\n    )\n  },\n\n  methods: {\n    connectSvcUi() {\n      window.location.replace(this.svc_ui_url)\n    },\n    getSvcUiUrl(\n      sso_url,\n      protocolDomainToValidate,\n      domainNameDomainToValidate,\n      protocolBo,\n      domainNameBo,\n      queryParams,\n      pubKey,\n      shopName,\n      nextStep\n    ) {\n      this.svc_ui_url =\n        sso_url +\n        '/link-shop/' +\n        protocolDomainToValidate +\n        '/' +\n        domainNameDomainToValidate +\n        '/' +\n        protocolBo +\n        '/' +\n        domainNameBo +\n        '/PSXEmoji.Deluxe.Fake.Service'\n\n      let boPath = ''\n      for (let [key, value] of Object.entries(queryParams)) {\n        boPath += key + '=' + value + '&'\n      }\nconsole.log('ddddddddd')\n      this.queryParams.bo =\n        'string' === typeof boPath\n          ? encodeURIComponent(boPath.slice(0, -1))\n          : null\n      this.queryParams.pubKey =\n        'string' === typeof pubKey ? encodeURIComponent(pubKey) : null\n      this.queryParams.name =\n        'string' === typeof window.shopName\n          ? encodeURIComponent(window.shopName)\n          : null\n      this.queryParams.next =\n        'string' === typeof nextStep ? encodeURIComponent(nextStep) : null\n      this.queryParamsLoaded()\n\n      return this.svc_ui_url\n    },\n\n    queryParamsLoaded() {\n      const countInitQueryParams = Object.keys(this.queryParams).length\n      let counterValideParams = 0\n      this.svc_ui_url += '?'\n      for (let [key, value] of Object.entries(this.queryParams)) {\n        if (null !== value) {\n          counterValideParams++\n          this.svc_ui_url += `${key}=${value}&`\n        }\n      }\n\n      if (countInitQueryParams === counterValideParams) {\n        this.params_loaded = true\n        this.svc_ui_url = this.svc_ui_url.slice(0, -1)\n      }\n    },\n  },\n}\n</script>\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n</style>\n"]}]}