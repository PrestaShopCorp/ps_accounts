services:
  _defaults:
    public: true

  ps_accounts.module:
    class: 'Ps_accounts'
    factory: ['Module', 'getInstanceByName']
    arguments:
      - 'ps_accounts'

  ps_accounts.context:
    class: Context
    factory: [ 'Context', 'getContext' ]

  ps_accounts.shop_context:
    class: PrestaShop\Module\PsAccounts\Context\ShopContext

  ps_accounts.configuration:
    class: PrestaShop\Module\PsAccounts\Adapter\Configuration
    arguments:
      - '@ps_accounts.context'

  ps_accounts.link:
    class: PrestaShop\Module\PsAccounts\Adapter\Link

  #####################
  # services.yml

  PrestaShop\Module\PsAccounts\Service\PsAccountsService:
    class: PrestaShop\Module\PsAccounts\Service\PsAccountsService
    arguments:
      - { accounts_ui_url: '%ps_accounts.svc_accounts_ui_url%',
          sso_account_url: '%ps_accounts.sso_account_url%' }
      - '@PrestaShop\Module\PsAccounts\Repository\ConfigurationRepository'
      - '@PrestaShop\Module\PsAccounts\Api\Client\FirebaseClient'
      - '@ps_accounts.module'

  PrestaShop\Module\PsAccounts\Service\PsBillingService:
    class: PrestaShop\Module\PsAccounts\Service\PsBillingService
    arguments:
      - '@PrestaShop\Module\PsAccounts\Repository\ConfigurationRepository'
      - '@PrestaShop\Module\PsAccounts\Api\Client\ServicesBillingClient'
      - '@PrestaShop\Module\PsAccounts\Service\PsAccountsService'
      - '@ps_accounts.module'

  #####################
  # handlers.yml

  PrestaShop\Module\PsAccounts\Handler\ErrorHandler\ErrorHandler:
    public: false
    class: PrestaShop\Module\PsAccounts\Handler\ErrorHandler\ErrorHandler
    arguments:
      - '@PrestaShop\Module\PsAccounts\Service\PsAccountsService'
      - '%ps_accounts.sentry_credentials%'

  #####################
  # api.yml

  PrestaShop\Module\PsAccounts\Api\Client\FirebaseClient:
    public: false
    class: PrestaShop\Module\PsAccounts\Api\Client\FirebaseClient
    arguments:
      - { api_key: '%ps_accounts.firebase_api_key%' }

  PrestaShop\Module\PsAccounts\Api\Client\ServicesBillingClient:
    public: false
    class: PrestaShop\Module\PsAccounts\Api\Client\ServicesBillingClient
    arguments:
      - { api_url: '%ps_accounts.svc_billing_api_url%' }
      - '@PrestaShop\Module\PsAccounts\Service\PsAccountsService'
      - '@ps_accounts.link'

  PrestaShop\Module\PsAccounts\Api\Client\ServicesAccountsClient:
    public: false
    class: PrestaShop\Module\PsAccounts\Api\Client\ServicesAccountsClient
    arguments:
      - { api_url: '%ps_accounts.svc_accounts_api_url%' }
      - '@PrestaShop\Module\PsAccounts\Service\PsAccountsService'
      - '@ps_accounts.link'

  #####################
  # repository.yml

  PrestaShop\Module\PsAccounts\Repository\ConfigurationRepository:
    class: PrestaShop\Module\PsAccounts\Repository\ConfigurationRepository
    arguments:
      - '@ps_accounts.configuration'
